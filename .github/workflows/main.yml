# Current Version: 1.0.0

name: Build & Release Atroc-X/GFWList-AGH

on:
  push:
    branches: [ main ]
  schedule:
    - cron: "00 03 * * *"
  watch:
    types: [started]

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Step 1 - Checkout
              uses: actions/checkout@v3.1.0
            - name: Step 2 - Build GFWList2AGH
              run: |
                  curl -s "https://raw.githubusercontent.com/Atroc-X/GFWList-AGH/source/release.sh" | sudo bash
            - name: Step 3 - Release GFWList2AGH
              run: |
                  sudo git config user.name github-actions
                  sudo git config user.email github-actions@github.com
                  sudo git add .
                  sudo git commit -m "Generated by GitHub Actions"
                  sudo git push --force
            - name: Install coscmd
              run: sudo pip install coscmd
            - name: Configure coscmd
              env:
                SECRET_ID: ${{ secrets.SecretId }}
                SECRET_KEY: ${{ secrets.SecretKey }}
                BUCKET: download-1302801676
                REGION: ap-shanghai
              run: coscmd config -a $SECRET_ID -s $SECRET_KEY -b $BUCKET -r $REGION
            - name: Upload files to COS
              run: coscmd upload -rfs --delete ./gfwlist2domain/blacklist_full.txt /Domainlist/blacklist_full.txt --ignore "./.git/*"
            - name: Upload files to COS
              run: coscmd upload -rfs --delete ./gfwlist2domain/whitelist_full.txt /Domainlist/whitelist_full.txt --ignore "./.git/*"
              
